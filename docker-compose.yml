  version: '3.8'

  services:
    backend:
      build:
        context: .
        dockerfile: Dockerfile.backend
      volumes:
        - static_volume:/static
        - media_volume:/media
      env_file:
        - .env
      ports:
        - "8000:8000"
      depends_on:
        - db
      command: >
        sh -c "
          python manage.py migrate &&
          python manage.py collectstatic --noinput &&
          gunicorn nsk.wsgi:application --bind 0.0.0.0:8000
        "

    frontend:
      build:
        context: .
        dockerfile: Dockerfile.frontend
      ports:
        - "3000:80"
      depends_on:
        - backend
      volumes:
        - static_volume:/static
        - media_volume:/media

    db:
      image: postgres:15
      environment:
        POSTGRES_DB: ${POSTGRES_DB}
        POSTGRES_USER: ${POSTGRES_USER}
        POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      volumes:
        - postgres_data:/var/lib/postgresql/data

  volumes:
    static_volume:
    media_volume:
    postgres_data:
